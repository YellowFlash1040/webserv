http {
    server {
    	listen 8080;

    	location / {
    		root ./assets/www/site0;
    		cgi_pass .py /usr/bin/python3;
    		# cgi_pass .php /usr/bin/php-cgi;
			cgi_pass .cgi /usr/bin/perl;
    		cgi_pass .sh /usr/bin/bash;
    	}

        location /pages/ {
            alias ./assets/www/site0/pages/;
            autoindex on;
        }

    	location /youtube {
    		return 301 https://www.youtube.com/;
    	}

        location /upload {
            limit_except GET POST DELETE;
            upload_store ./assets/www/site0/uploads;
            client_max_body_size 0;
        }

        location /uploads/ {
            limit_except GET DELETE;
            alias ./assets/www/site0/uploads/;
            autoindex on;
        }
    }

    server {
        listen 8081;
        root ./assets/www/site1;

    	client_max_body_size 20M;
    	error_page 400 /errors/400.html;
    	error_page 403 /errors/403.html;
    	error_page 404 /errors/404.html;
    	error_page 405 /errors/405.html;
    	error_page 413 /errors/413.html;
    	error_page 500 /errors/50x.html;

        cgi_pass .py "/usr/bin/python3";
		cgi_pass .sh "/bin/bash";
    }

    server
	{
		listen 8082;
		server_name localhost2;
		root ./assets/www/site2;

		# Page with upload form
		location /upload/
		{
			alias ./assets/www/site2/;
			limit_except GET;
			index index.html;
		}
		
		# Uploaded files with auto_index
		location /uploads/ 
		{
			alias ./assets/www/site2/uploads/;
			limit_except GET;
			autoindex on;
		}

		# POST uploaded files
		location /upload_post/
		{
			alias ./assets/www/site2/uploads/;        # folder where files will be saved
			upload_store ./assets/www/site2/uploads/; # must be set for POST to work
			limit_except GET POST;                     # allow POST (and optional GET)
		}

		# DELETE uploaded files
		location /upload_delete/ 
		{
			alias ./assets/www/site2/uploads/;
			limit_except DELETE;
		}
	}

	server
	{
		listen 8083;
		server_name localhost3;

		root ./assets/www/site3;

		# Root: should serve index.html
		location /
		{
		}
		
		location /redirect_test/
		{
			return 302 /redirect_target/;
		}
		
		location /method_test/
		{
			alias ./assets/www/site3/method_test/;
			limit_except POST;
		}

		location /cgi_bin/
		{
			alias ./assets/www/site3/cgi_bin/;
			limit_except GET POST;
			cgi_pass .py /usr/bin/python3;
		}
		
		# Directory WITH index file -> default serve index.html
		location /with_index/
		{

		}
		
		location /custom_index_exists/
		{
			alias ./assets/www/site3/custom_index_exists/;
			index main_page.html;
		}
		
		location /multiple_index/
		{
			alias ./assets/www/site3/multiple_index;
			index index1.html index2.html index3.html;
		}
		
		location /custom_index_missing/
		{
			alias ./assets/www/site3/custom_index_missing/;
			index missing_page.html;
		}
		
		location /index_not_readable/
		{
			alias ./assets/www/site3/index_not_readable/;
			index unreadable.txt;
		}
		
		location /custom_index_missing_autoindex/
		{
			alias ./assets/www/site3/custom_index_missing/;
			index missing_page.html;
			autoindex on;
		}

		location /index_not_readable_autoindex/
		{
			alias ./assets/www/site3/index_not_readable/;
			index unreadable.txt;
			autoindex on;
		}
		
		location /no_index_no_autoindex/
		{
			alias ./assets/www/site3/no_index_no_autoindex/;
			autoindex off;
		}
		
		location /delete_nonexistent_file/
		{
			alias ./assets/www/site3/delete_test/;  # directory exists but empty
			limit_except DELETE;
		}
		
		location /delete_no_permission/
		{
			alias ./assets/www/site3/delete_no_permission/;  # contains a file with no write permissions
			limit_except DELETE;
		}
		
		location /delete_test/
		{
			alias ./assets/www/site3/delete_test/;  # directory for testing DELETE
			limit_except DELETE;
		}
		
		location /upload_post/
		{
			alias ./assets/www/site3/upload_post/;
			upload_store ./assets/www/site3/upload_post/;
			client_max_body_size 10;
		}

		location /dir_not_accessible/
		{
			alias ./assets/www/site3/dir_not_accessible/;
			index file.txt;
		}
	}
}
